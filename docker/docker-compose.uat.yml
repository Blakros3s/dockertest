# ==============================================================================
# UAT Environment Overlay
# Use with: docker compose -f docker-compose.base.yml -f docker-compose.uat.yml
# ==============================================================================

services:
  # ============================================================================
  # PostgreSQL Database - UAT overrides
  # ============================================================================
  db:
    env_file:
      - ../backend/.env.uat

  # ============================================================================
  # Django Backend - UAT overrides
  # ============================================================================
  backend:
    build:
      dockerfile: docker/backend/Dockerfile.uat
    env_file:
      - ../backend/.env.uat
    ports:
      - "127.0.0.1:${BACKEND_PORT:-8012}:8000"
    volumes:
      - ../backend/staticfiles:/app/staticfiles
      - ../backend/media:/app/media
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 1G

  # ============================================================================
  # Next.js Frontend - UAT overrides
  # ============================================================================
  frontend:
    build:
      dockerfile: docker/frontend/Dockerfile
      args:
        NEXT_PUBLIC_API_URL: ${NEXT_PUBLIC_API_URL}
    env_file:
      - ../frontend/.env.production
    ports:
      - "127.0.0.1:${FRONTEND_PORT:-3012}:3000"
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
